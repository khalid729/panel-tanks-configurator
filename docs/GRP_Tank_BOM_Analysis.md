# تحليل شامل لملف GRP Tank BOM System
## Al Muhaideb National Tanks - نظام حساب تكلفة وقائمة مواد خزانات GRP

---

## 1. نظرة عامة على النظام

### الغرض من الملف:
نظام متكامل لحساب:
- قائمة المواد (Bill of Materials - BOM) لخزانات GRP Panel
- تكلفة المواد الخام
- أوزان المكونات
- تجهيز الشحنات والتغليف

### الأوراق الرئيسية (31 ورقة):
| # | اسم الورقة | الحالة | الوظيفة |
|---|------------|--------|---------|
| 1 | BASIC_TOOL | ظاهرة | الورقة الرئيسية لإدخال البيانات |
| 2 | PRINTOUT(BOM) | ظاهرة | طباعة قائمة المواد |
| 3 | PRINTOUT(COST) | ظاهرة | طباعة التكلفة |
| 4 | PRINTOUT(WT) | ظاهرة | طباعة الأوزان |
| 5 | Weight_Table | ظاهرة | جدول أوزان المكونات |
| 6 | 0.39 | ظاهرة | جدول الأسعار (570 منتج) |
| 7 | Panel | مخفية | حسابات الألواح |
| 8 | Panel_Config | مخفية | تكوين الألواح |
| 9 | Steel_Skid | مخفية | الهيكل الحديدي |
| 10 | BoltnNuts | مخفية | البراغي والصواميل |
| 11 | Internal_Reinforcing | مخفية | التقوية الداخلية |
| 12 | External_Reinforcing | مخفية | التقوية الخارجية |
| 13 | Internal_Tie_rod1 | مخفية | قضبان الربط الداخلية |
| 14 | Fittings | مخفية | التركيبات |
| 15 | ETC | مخفية | ملحقات أخرى |

---

## 2. المتغيرات الأساسية (Named Ranges)

### أبعاد الخزان:
```
W_O  = العرض الأصلي (BASIC_TOOL!B69)
L_O  = الطول الإجمالي (BASIC_TOOL!K70)
H_O  = الارتفاع الأصلي (BASIC_TOOL!L69)

L1_O = الطول 1 (BASIC_TOOL!D69)
L2_O = الطول 2 (BASIC_TOOL!F69)
L3_O = الطول 3 (BASIC_TOOL!H69)
L4_O = الطول 4 (BASIC_TOOL!J69)

N_PA = عدد الحواجز الداخلية (BASIC_TOOL!K11)
```

### صيغ حساب الأبعاد:
```
W_C = TRUNC(Width)           # الجزء الصحيح من العرض
W_F = Width - W_C            # الجزء العشري (0.5 إذا وجد)

L1_C = TRUNC(Length1)
L1_F = Length1 - L1_C

H_C = TRUNC(Height)
H_F = Height - H_C
```

---

## 3. بيانات الإدخال الأساسية (BASIC_TOOL)

### معلومات الطلب (صف 5-8):
| الخلية | البيان |
|--------|--------|
| B5 | رقم الطلب (Order No.) |
| B6 | اسم المشروع |
| D5 | تاريخ الطلب =TODAY() |
| F5 | المسمى الوظيفي |
| H5 | اسم مندوب المبيعات |
| B7 | الموقع |
| F7 | تاريخ التسليم |
| B8 | شروط الدفع |
| D8 | ميناء التفريغ |

### أبعاد الخزان (صف 10-11):
| الخلية | البيان | مثال |
|--------|--------|------|
| A11 | العرض (Width) | 10 |
| B11 | الطول 1 (Length1) | 5 |
| C11 | الطول 2 (Length2) | - |
| D11 | الطول 3 (Length3) | - |
| E11 | الطول 4 (Length4) | - |
| F11 | الارتفاع (Height) | 3 |
| G11 | الكمية (Q'ty) | 1 |

### حسابات السعة:
```
السعة الاسمية (H11) = W * (L1+L2+L3+L4) * H
السعة الفعلية (I11) = W * (L1+L2+L3+L4) * (H-0.2)
المساحة (J11)       = W*L*2 + W*H*2 + L*H*2 + W*H*N_PA
```

### خيارات الألواح (صف 13-15):
| الخلية | البيان | الخيارات |
|--------|--------|----------|
| B14 | نوع المنتج | MNT, Not Included |
| C14 | العزل | Non-Insulated, Insulated, Insulated Roof Only |
| D14 | استخدام ألواح جانبية 1x1م | YES, NO |
| E14 | استخدام ألواح حاجز 1x1م | YES, NO |

### خيارات الملحقات الفولاذية (صف 21-23):
| الخلية | البيان | الخيارات |
|--------|--------|----------|
| B22 | نوع التقوية | Internal, External |
| C22 | طريقة التقوية | MNT |
| D22 | الهيكل الحديدي | Default, Angle 75, Channel 125, Channel 150 |
| E22 | المواد الداخلية | SS316, SS304 |
| F22 | البراغي والصواميل | EXT:HDG+INT:SS316, EXT:HDG+INT:SS304 |
| G22 | قضبان الربط | SS316, SS304, SS304+PET coated |
| H22 | مواصفات قضيب الربط | 3mH_Tie_Rod(2+1), 3mH_Tie_Rod(1+1) |

### ملحقات إضافية (صف 25-27):
| الخلية | البيان | الخيارات |
|--------|--------|----------|
| B26 | مؤشر المستوى | General, Special, No needed |
| E26 | مادة السلم الداخلي | GRP, SS304, SS316L |
| F26 | كمية السلم الداخلي | Default |
| G26 | مادة السلم الخارجي | HDG, SS304, SS316 |

---

## 4. جدول الأسعار (ورقة 0.39)

### هيكل الجدول:
- العمود B: رقم القطعة (Part No.)
- العمود C: اسم القطعة (Korean)
- العمود D: سعر الشراء (USD)
- العمود E: المواصفات
- العمود F: اسم القطعة (English)

### عينة من الأسعار (570 منتج):
```
# الفلنجات والوصلات
WSF-150A (Slant Flange 150A): $32.7
WSF-125A (Slant Flange 125A): $32.6
WFL-200A (Flat Flange 200A): $32.2
WSD-050A (Socket Brass 50A): $31.6

# دعامات السقف
WRS-5000F (Roof Supporter 5.0mH): $110
WRS-3000F (Roof Supporter 3.0mH): $66
WRS-1500F (Roof Supporter 1.5mH): $33

# مؤشرات المستوى
WLV-5000SET(G): $750
WLV-3000SET(G): $450
WLV-3000SET(S): $29.5

# السلالم
WLD-5000ZO (EX-Ladder 5mH HDG): $455
WLD-5000FI (Internal Ladder 5mH GRP): $450
WLD-3000ZO (EX-Ladder 3mH HDG): $275

# الهيكل الحديدي
WFF-2640HCSZ (Channel 150mm): $330
WFF-2640ASZ (Angle 75mm): $200
WFF-1990HCLZ (Channel 150mm): $217
```

---

## 5. جدول الأوزان (Weight_Table)

### عينة من الأوزان (150+ منتج):
```
# البراغي والكتائف
WBR-0120Z: 1.06 kg
WBR-1717S: 4.9 kg
WBR-9090Z: 0.78 kg
WBT-1412RD: 0.263 kg
WBT-1630SU: 0.097 kg

# الأقنية والقنوات
WCF-1000F: 2.5 kg
WCF-1000ZT: 4 kg

# الكابات والأغطية
WCP-1616ZO: 2.8 kg
WCP-1717S: 0.5 kg
WCP-7070Z: 5.79 kg

# إطارات القاعدة
WFB-0450Z: 0.964 kg
WFB-0880Z: 1.865 kg
WFB-1200Z: ~3.3 kg
WFB-2945Z: 9.05 kg
```

---

## 6. تكوين الألواح (Panel_Config)

### جدول تركيب الألواح حسب الارتفاع:
```
الارتفاع    الألواح الجانبية                    السقف
1.0mH    SF10S, SH10S                       RF00M, RH10M
1.5mH    SL15S, SQ10T                       RF00M, RH10M
2.0mH    SL20S, SH10T, SH20M               RF00M, RH10M
2.5mH    SL15T, SH10T, SQ15M               RF00M, RH10M
3.0mH    SL20T, SH10T, SH20M, SF25M        RF00M, RH10M
3.5mH    SL15T, SH10T, SQ15M               RF00M, RH10M
4.0mH    SL20T, SH10T, SH20M               RF00M, RH10M
4.5mH    SL15T, SH10T                       RF00M, RH10M
5.0mH    SL20T, SH10T                       RF00M, RH10M
```

### ألواح القاع:
```
BF10M, BH10M (1mH)
BF20M, BH20M (2mH)
BF30, BH30M (3mH)
BF40M, BH40M (4mH)
BF50M, BH50M (5mH)
```

### ألواح الصرف:
```
DN10M, DN15M, DN20M, DN25M, DN30M, DN35M, DN40M, DN45M, DN50M
```

### ألواح غرفة التفتيش:
```
MF00M (لجميع الارتفاعات)
```

---

## 7. معادلات حساب التكلفة (PRINTOUT(COST))

### صيغة حساب تكلفة كل قطعة:
```
سعر القطعة = VLOOKUP(Part_No, '0.39'!B:D, 3, FALSE)
التكلفة الإجمالية = الكمية × سعر القطعة
```

### ملخص التكاليف:
```
Panels (G58)           = ROUNDUP(B58, -2)
Steel Skid (G59)       = ROUNDUP(B59, -2)
Bolt & Nuts (G60)      = ROUNDUP(B60, -2)
External Reinforcing (G61) = ROUNDUP(B61, -2)
Internal Reinforcing (G62) = ROUNDUP(B62, -2)
Internal Tie-rod (G63) = ROUNDUP(B63, -2)
Etc (G64)              = ROUNDUP(B64, -2)
Fittings (G65)         = ROUNDUP(B65, -2)

Total (G66) = SUM(G58:G65)
```

### تحويل العملة:
```
السعر بالريال = السعر بالدولار × سعر الصرف (E33)
مثال: سعر الصرف = 1050
```

---

## 8. معادلات الهيكل الحديدي (Steel_Skid)

### اختيار نوع الهيكل:
```
إذا D23=1: Default
إذا D23=2: Angle 75
إذا D23=3: Channel 125
إذا D23=4: Channel 150
إذا D23=5: Except SKD
```

### اختيار المقاس حسب الارتفاع:
```
إذا H_O > 4.3م: استخدم Channel 150
إذا H_O > 2.5م: استخدم Channel 125
إذا H_O > 0م:   استخدم Angle 75
```

---

## 9. VBA Macros الموجودة

### 1. Worksheet_Change (Sheet1 - BASIC_TOOL):
- يتفعل عند تغيير أي قيمة في النطاق A10:K30
- ينسخ القيم المحسوبة من المناطق المؤقتة إلى مناطق الطباعة
- يحدث: الألواح، الهيكل الحديدي، البراغي، التقوية الداخلية والخارجية، قضبان الربط، الملحقات، التركيبات

### 2. Module5 - ´ÜÃß1_Click:
- تصدير BOM إلى ملف Excel جديد
- إضافة شعار الشركة
- حفظ الملف باسم وتاريخ

### 3. Module4 - ÃâÇÏ¸®½ºÆ®_»ý¼º:
- إنشاء قائمة التسليم
- نسخ بيانات الألواح والهيكل والملحقات

### 4. Sheet17 (PACKING) - Worksheet_Activate:
- حساب تعبئة الطبليات (Pallets)
- توزيع الألواح على الطبليات بحد أقصى 25 طبقة

---

## 10. هيكل التطبيق البديل المقترح

### الوحدات الرئيسية:

```
1. TankInputModule (وحدة الإدخال)
   - إدخال أبعاد الخزان (العرض، الطول، الارتفاع)
   - إدخال خيارات الألواح والعزل
   - إدخال خيارات الملحقات الفولاذية
   - إدخال معلومات العميل والمشروع

2. CalculationEngine (محرك الحسابات)
   - حساب السعة (الاسمية والفعلية)
   - حساب المساحة الإجمالية
   - حساب عدد الألواح لكل نوع
   - حساب كمية الملحقات

3. PanelConfigModule (وحدة تكوين الألواح)
   - تحديد أنواع الألواح حسب الارتفاع
   - حساب كمية كل نوع
   - مراعاة خيار الألواح 1×1م

4. SteelSkidModule (وحدة الهيكل الحديدي)
   - اختيار نوع الهيكل
   - حساب القطع حسب الأبعاد
   - حساب الكميات

5. PricingModule (وحدة التسعير)
   - البحث عن الأسعار من جدول الأسعار
   - حساب التكلفة الإجمالية
   - تحويل العملة

6. WeightModule (وحدة الأوزان)
   - البحث عن الأوزان من جدول الأوزان
   - حساب الوزن الإجمالي

7. PackingModule (وحدة التغليف)
   - توزيع الألواح على الطبليات
   - حساب عدد الحاويات

8. ReportModule (وحدة التقارير)
   - إنشاء BOM
   - إنشاء تقرير التكلفة
   - إنشاء تقرير الأوزان
   - تصدير PDF/Excel
```

---

## 11. قواعد البيانات المطلوبة

### 1. جدول الأسعار (prices):
```sql
CREATE TABLE prices (
    id INTEGER PRIMARY KEY,
    part_no VARCHAR(50) UNIQUE,
    part_name_kr VARCHAR(100),
    price_usd DECIMAL(10,2),
    spec VARCHAR(200),
    part_name_en VARCHAR(100)
);
-- إجمالي: 570 سجل
```

### 2. جدول الأوزان (weights):
```sql
CREATE TABLE weights (
    id INTEGER PRIMARY KEY,
    part_no VARCHAR(50) UNIQUE,
    weight_kg DECIMAL(10,4)
);
-- إجمالي: 150+ سجل
```

### 3. جدول تكوين الألواح (panel_config):
```sql
CREATE TABLE panel_config (
    id INTEGER PRIMARY KEY,
    height DECIMAL(3,1),
    panel_type VARCHAR(20),
    panel_code VARCHAR(20),
    use_1x1_panel BOOLEAN
);
```

### 4. جدول الهيكل الحديدي (steel_skid_config):
```sql
CREATE TABLE steel_skid_config (
    id INTEGER PRIMARY KEY,
    height_min DECIMAL(3,1),
    height_max DECIMAL(3,1),
    skid_type VARCHAR(20),
    part_no VARCHAR(50)
);
```

---

## 12. الخلاصة

### المدخلات الأساسية:
1. أبعاد الخزان (العرض × الطول × الارتفاع)
2. نوع الألواح والعزل
3. نوع الهيكل الحديدي
4. مواد الملحقات (SS316/SS304/HDG)
5. التركيبات والوصلات المطلوبة

### المخرجات:
1. قائمة المواد (BOM) مع الكميات
2. التكلفة الإجمالية بالدولار والريال
3. الوزن الإجمالي
4. خطة التغليف والشحن

### المعادلات الأساسية:
```
السعة = العرض × الطول × الارتفاع
المساحة = 2×(W×L + W×H + L×H) + W×H×عدد_الحواجز
التكلفة = مجموع(الكمية × سعر_القطعة)
الوزن = مجموع(الكمية × وزن_القطعة)
```

---

تم إنشاء هذا التحليل بتاريخ: 2026-01-04
